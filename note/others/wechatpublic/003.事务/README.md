# 数据库事务



谈起数据库事务，都会想起银行转账的案例吧（A给B转账一笔金额，A账户减少、B账户增加）。



事务，是数据库特性中的一条。在高性能mysql一书中，提出了了解mysql其他高级特性前，应该先了解事务。当然，事务其实也是一个比较容易理解的东西（因为其并没有和引擎层和服务层等打交道）。



但是首先要知道在MySQL中，Innodb引擎是支持事务的，而MyISAM引擎是不支持事务的，以下在MySQL中说的都是Innodb引擎。



事务，我们简单来说就是一组（一条或多条）sql语句。要么全部执行成功，要么全部执行失败。因此转账案例是最典型的例子。

https://img-blog.csdnimg.cn/2021012910184474.jpg

经常面试的朋友就会知道，事务这里是必问的内容。首先就是其四大特性ACID。



- 原子性 Atomicity

  一个事务必须看做一个不可再分的基本单位，要么全部成功，要不失败回滚。

  不可能只操作其中一部分。

    

- 一致性 Consistency

    数据库总是从一个一致性状态转换到另一个一致性状态

      

- 隔离性 Isolation

    一般来说，一个事务所做的修改在未提交时，对其他事务是不可见的。
    根据情况又有不同的隔离级别。

     

- 持久性 Durability

  一旦事务提交，其所做的修改就会永久保存到数据库内。
  
  

答出这些之后，那么就会有数据库的隔离级别有哪些，各个隔离级别会有什么问题，默认的隔离级别是什么，又是如何解决问题的呢？



这一连串的问题，如果不是特别熟悉，那么肯定会在某个问题上卡壳，被问住。



因为隔离级别的原因，会有脏读、不可重复度、幻读的问题。



理解这些问题前首先要了解：

事务的执行是将sql语句执行，全部sql执行后才会提交，如果某条语句出错，则整个事务回滚到执行之前的状态。另一个就是mysql中innodb引擎的中将每个单独的sql语句也看作事务来操作的。



- 脏读 ：就是事务读取了其他事务未提交的数据。导致读取错误。
- 不可重复读：这个就是事务在连续读取的时候读取了不同的数据，称之为不可重复读
- 幻读：在事务执行间，操作的数据库行之间多出行，称之为幻行，读取的这个就为幻读



数据库的隔离级别为Read Uncommitted、Read Committed、Repeatable Read、Serializable，分别是未提交读、已提交读、可重复读、可串行化。



在mysql中，默认的隔离级别是可重复读。其中各个隔离级别会产生如图所示的问题：

<img src="https://img-blog.csdnimg.cn/20200926182152329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMzYwNzgw,size_16,color_FFFFFF,t_70#pic_center" alt="隔离级别" width="100%" style=""/>



答出这些之后，可算你的基本功到位了，但是面试官如果追问的话，那么可能还会问你，mysql默认隔离级别会产生幻读问题，mysql是如何解决的？



如果你还能答出间隙锁，那么我估计你事务方面在面试中得分应该比较不错的。



至于在其他的，事务的多版本并发控制MVCC这些，一般也不会问。（如果想了解的话，点击阅读原文到博客中详见）



最后，既然事务保证了sql组一定全部成功或全部失败，那么在中间断电的情况，事务如何保证回滚？



数据库一般都都有数据文件和日志文件，这里一般把每次的记录都会写在日志文件内，等服务器再次启动起来，通过日志文件就可恢复数据，回滚或继续执行操作。



当然最后提醒一句，以上所说都是单机事务的情况，而在分布式事务中，情况远远比单机情况复杂，会有各种情况的出现。有兴趣的同学可以自行先摸索摸索。



https://blog.csdn.net/qq_43360780/article/details/108814307

