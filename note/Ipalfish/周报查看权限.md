# okr管理

## 公开周报

- **数据库**

```sql
create table `okr_weekly_authority`
(
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY   COMMENT '自增主键',
    `op_name` VARCHAR(64)   NOT NULL         COMMENT '权限记录者',
    `type` INT DEFAULT 0    NOT NULL         COMMENT '公开周报 0不公开 1下属可见',
    `created_at` BIGINT      NOT NULL        COMMENT '记录创建时间',
    `updated_at` BIGINT      NOT NULL        COMMENT '最后更新时间',
  	UNIQUE KEY `uniq_opname` (`op_name`)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4
  collate utf8mb4_bin comment '周报公开表';
```

- **接口**

```properties
//全部为新增

struct SetWeeklyAuthorityReq{
    1:i64 type
    101:string op_user_name
}
struct SetWeeklyAuthorityRes{
    1:optional bool flag
    1000:optional ThriftUtil.ErrInfo errinfo
}
struct GetWeeklyAuthorityReq{
    1:string op_user_name
}
struct GetWeeklyAuthorityRes{
    1:optional i64 type
    1000:optional ThriftUtil.ErrInfo errinfo
}

SetWeeklyAuthorityRes SetWeeklyAuthority(1:SetWeeklyAuthorityReq req,10:ThriftUtil.Context tctx)
GetWeeklyAuthorityRes GetWeeklyAuthority(1:GetWeeklyAuthorityReq req,10:ThriftUtil.Context tctx)
```

```text
//权限设置与获取
{"/weekly/authority/get", opapiutil.InitStandardReq(okr.FactoryGetWeeklyAuthority)},

{"/weekly/authority/set", opapiutil.InitStandardReq(okr.FactorySetWeeklyAuthority)},
```

## 添加上传与下载附件

- **接口**

```
//修改接口 （添加参数）

struct SetWeeklyReq{
    1:i64 id
    2:string content
    3:WeeklyState state
    4:[]byte reader   //添加文件
    100:string op_user_name
}

struct GetWeeklyInfo{
    1:optional WeeklyInfo last_week_info
    2:optional WeeklyInfo current_week_info
    3:optional []byte last_week_file 			//添加
    4:optional []byte current_week_info		//添加
}
```

- **数据库**

```sql
create table `okr_weekly_file`
(
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY  COMMENT '自增主键',
    `weekly_id` int   			NOT NULL        COMMENT '周报id',
  	`file_uri`	varchar			NOT NULL				COMMENT '文件URI',
    `created_at` BIGINT      NOT NULL        COMMENT '记录创建时间',
    `updated_at` BIGINT      NOT NULL        COMMENT '最后更新时间',
  	UNIQUE KEY `uniq_weekly_id` (`weekly_id`)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4
  collate utf8mb4_bin comment '文件URI';
```





